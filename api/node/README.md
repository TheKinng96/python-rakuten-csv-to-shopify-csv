# Shopify GraphQL Operations

Node.js GraphQL operations for Shopify product management, working in hybrid with Python analysis scripts.

## Setup

1. **Install dependencies**:
```bash
cd node
npm install
```

2. **Configuration**: Uses the shared `.env` file from parent `api/` directory. No additional configuration needed.

3. **Test connection**:
```bash
npm run test
```

## Architecture

### Hybrid Approach
- **Python scripts**: CSV analysis, data processing, report generation
- **Node.js scripts**: GraphQL operations, bulk mutations, API interactions

### Data Flow
```
CSV Data → Python Analysis → Reports → JavaScript GraphQL Operations → Shopify
```

## Scripts

### Connection Test
```bash
npm run test
# Tests GraphQL connection to your test store
```

### Product Import
```bash
npm run import
# Imports products using GraphQL bulk operations
# Uses data from ../data/ folder
```

### SS Images Removal  
```bash
npm run remove-ss
# Removes -XXss.jpg images using Python analysis results
# Uses reports/01_ss_images_analysis.csv
```

### HTML Tables Fix
```bash
npm run fix-tables  
# Fixes HTML table structures using GraphQL
# Uses reports/02_html_tables_analysis.csv
```

### Rakuten Content Cleanup
```bash
npm run clean-rakuten
# Removes EC-UP content using GraphQL
# Uses reports/03_rakuten_patterns_found.csv
```

## Integration with Python

The Node.js scripts read analysis reports generated by Python scripts:

1. **Run Python analysis** (from `api/` directory):
```bash
uv run scripts/01_remove_ss_images.py      # Generates analysis report
uv run scripts/02_fix_html_tables.py       # Generates analysis report  
uv run scripts/03_clean_rakuten.py         # Generates analysis report
```

2. **Run GraphQL operations** (from `api/node/` directory):
```bash
npm run remove-ss     # Uses Python analysis results
npm run fix-tables    # Uses Python analysis results
npm run clean-rakuten # Uses Python analysis results
```

## GraphQL Advantages

- **Bulk Operations**: Process thousands of products efficiently
- **Precise Updates**: Update only specific fields without full product replacement
- **Better Error Handling**: Detailed GraphQL error responses
- **Admin Dashboard Testing**: Test queries in Shopify GraphQL explorer
- **Rate Limiting**: Built into Shopify's official client library
- **Type Safety**: GraphQL schema validation

## File Structure

```
node/
├── src/
│   ├── config.js              # Shared configuration (uses ../env)
│   ├── shopify-client.js      # GraphQL client wrapper
│   ├── test_connection.js     # Connection testing
│   ├── 00_import_products.js  # Product import via GraphQL
│   ├── 01_remove_ss_images.js # SS image removal via GraphQL
│   ├── 02_fix_html_tables.js  # HTML table fixes via GraphQL
│   └── 03_clean_rakuten.js    # Rakuten content cleanup via GraphQL
├── queries/                   # GraphQL queries and mutations
└── shared/                    # Shared data between Python and Node.js
```

## Development

- **Watch mode**: `npm run dev` (auto-restarts on file changes)
- **Debugging**: Uses same `.env` configuration as Python scripts
- **Logging**: Configured via `LOG_LEVEL` in `.env`